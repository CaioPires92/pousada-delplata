// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
  previewFeatures = ["driverAdapters"]
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model RoomType {
  id          String   @id @default(uuid())
  name        String
  description String
  capacity    Int
  maxGuests   Int      @default(3)
  includedAdults Int   @default(2)
  totalUnits  Int      @default(1)
  basePrice   Decimal
  extraAdultFee Decimal @default(0)
  child6To11Fee Decimal @default(0)
  amenities   String   // JSON string or comma separated
  photos      Photo[]
  bookings    Booking[]
  rates       Rate[]
  inventory   InventoryAdjustment[]
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Photo {
  id          String   @id @default(uuid())
  url         String
  roomTypeId  String
  roomType    RoomType @relation(fields: [roomTypeId], references: [id], onDelete: Cascade)
}

model Rate {
  id          String   @id @default(uuid())
  roomTypeId  String
  roomType    RoomType @relation(fields: [roomTypeId], references: [id], onDelete: Cascade)
  startDate   String
  endDate     String
  price       Decimal
  
  // New fields for Booking-style calendar rules
  cta         Boolean  @default(false) // Closed to Arrival
  ctd         Boolean  @default(false) // Closed to Departure
  stopSell    Boolean  @default(false) // Closed / Blocked
  minLos      Int      @default(1)     // Minimum Length of Stay
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model InventoryAdjustment {
  id          String   @id @default(uuid())
  roomTypeId  String
  roomType    RoomType @relation(fields: [roomTypeId], references: [id], onDelete: Cascade)
  date        String
  totalUnits  Int      // Total available units for this specific date
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@unique([roomTypeId, date])
}

model Guest {
  id          String    @id @default(uuid())
  name        String
  email       String
  phone       String
  bookings    Booking[]
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}

model Booking {
  id          String   @id @default(uuid())
  guestId     String
  guest       Guest    @relation(fields: [guestId], references: [id])
  roomTypeId  String
  roomType    RoomType @relation(fields: [roomTypeId], references: [id])
  checkIn     DateTime
  checkOut    DateTime
  totalPrice  Decimal
  status      String   // PENDING, CONFIRMED, CANCELLED, COMPLETED
  payment     Payment?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Payment {
  id            String   @id @default(uuid())
  bookingId     String   @unique
  booking       Booking  @relation(fields: [bookingId], references: [id])
  amount        Decimal
  provider      String   // MERCADOPAGO
  providerId    String?  // Mercado Pago Payment ID
  status        String   // PENDING, APPROVED, REJECTED
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model AdminUser {
  id        String   @id @default(uuid())
  email     String   @unique
  passwordHash String
  name      String?
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
